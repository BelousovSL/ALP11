# Название выполняемого задания;
Написать скрипт на языке Bash;

# Текст задания
Написать скрипт для CRON, который раз в час будет формировать письмо и отправлять на заданную почту.


Необходимая информация в письме:

Список IP адресов (с наибольшим кол-вом запросов) с указанием кол-ва запросов c момента последнего запуска скрипта;
Список запрашиваемых URL (с наибольшим кол-вом запросов) с указанием кол-ва запросов c момента последнего запуска скрипта;
Ошибки веб-сервера/приложения c момента последнего запуска;
Список всех кодов HTTP ответа с указанием их кол-ва с момента последнего запуска скрипта.
Скрипт должен предотвращать одновременный запуск нескольких копий, до его завершения.

В письме должен быть прописан обрабатываемый временной диапазон.

# Детали реализации

## simulatorAddingLogs.sh
Скрипт который эмитирует добавление логов в /var/log/nginx/access.log дана база в виде 670 записей, скрипт добавляет записи в течении 5 минут. +/- случайное число в интервале 300 миллисекунд. Визуально выглядит как реальная работа web сервера. 
Запускается службой simulator.service

## sendMail.sh
Я не стал реализовывать настоящую отправку, хотя в начале и начал, хотел это увязать через google, а у него сейчас как-то усложнилась процедура отправки... В общем подумал это не сама цель домашней работы. Но если нужна отправка через почту верните, реализую.

Сейчас скрипт, смотрит какое письмо последнее и создает новое увеличивая индекс в имени письма. 
Папка mails смонтирована на хостовую mails в проекте.  
Скрипт копируется в /usr/local/sbin/ что бы он был по дефолту доступен в PATH

## counting.sh
Основной скрипт. Файл 'state' используется для сохранение состояние между запусками скрипта. Я не использовал отметки времени так как по данному файлу видно что в одно и то же время есть разные записи. Чисто теоретически можно попасть на разрыв дат и статистика будет не точной. Поэтому использую хеши, теоретически тоже возможен разрыв, но крайне мало вероятно.

Запускается как служба + таймер. Не cron как требовалась, просто его не люблю, если требуется, могу в нем.

# Моделирование 
```bash
vagrant up
```

Через 15-25 сек. Начнут появляться письма (файлы)

Пример 1.mail
```text
Начало временного отрезка: 14/Aug/2019:04:12:10 +0300
Hash первой строки временного отрезка: f60a1c7655def0059ec96f14ebddcaec  -
Окончание временного отрезка: 14/Aug/2019:06:07:59 +0300
Hash последней строки временного отрезка: 9304abb18fb5c89235f4f694a5e0d10f  -
Список IP адресов (с наибольшим кол-вом запросов) с указанием кол-ва запросов c момента последнего запуска скрипта:
3 165.22.19.102
3 178.128.121.8
2 107.179.102.58
2 95.108.181.93
1 141.8.141.135
1 176.9.56.104
1 181.214.191.196
1 189.8.68.41
1 191.115.71.210
1 191.96.41.52
Список запрашиваемых URL (с наибольшим кол-вом запросов) с указанием кол-ва запросов c момента последнего запуска скрипта:
13 /
4 /wp-login.php
3 /xmlrpc.php
2 /wp-content/plugins/uploadify/readme.txt
1 /favicon.ico
1 /robots.txt
1 /sitemap-pt-post-2017-06.xml
1 /tag/overcommit_ratio/
1 /wp-admin/admin-post.php?page=301bulkoptions
1 /wp-cron.php?doing_wp_cron=1565748350.8502669334411621093750
Ошибки веб-сервера/приложения c момента последнего запуска:
4 404
1 500
Список всех кодов HTTP ответа с указанием их кол-ва с момента последнего запуска скрипта:
20 200
6 301
4 404
1 500
```

Пример 2.mail
```text
Начало временного отрезка: 14/Aug/2019:06:07:59 +0300
Hash первой строки временного отрезка: 9304abb18fb5c89235f4f694a5e0d10f  -
Окончание временного отрезка: 14/Aug/2019:09:17:15 +0300
Hash последней строки временного отрезка: 8799eb3b896e5dc2d34d2eea8b824c10  -
Список IP адресов (с наибольшим кол-вом запросов) с указанием кол-ва запросов c момента последнего запуска скрипта:
14 188.43.241.106
5 71.6.199.23
3 159.65.126.173
3 165.22.19.102
3 35.240.189.61
3 54.39.196.33
2 165.227.50.203
2 165.227.60.134
2 23.228.90.99
2 78.39.67.210
Список запрашиваемых URL (с наибольшим кол-вом запросов) с указанием кол-ва запросов c момента последнего запуска скрипта:
24 /
11 /wp-login.php
6 /robots.txt
6 /xmlrpc.php
3 /wp-includes/js/wp-embed.min.js?ver=5.0.4
1 /1
1 /2016/10/03/%D0%BF%D0%BE%D0%B4%D0%B3%D0%BE%D1%82%D0%BE%D0%B2%D0%BA%D0%B0-%D0%BA-%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B5-oracle-12%D1%81-%D0%BD%D0%B0-centos-7/
1 /2016/10/26/%D0%A1%D0%B5%D1%82%D0%B5%D0%B2%D1%8B%D0%B5-%D0%BF%D1%80%D0%BE%D0%B1%D0%BB%D0%B5%D0%BC%D1%8B-%D1%81-%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D0%BA%D0%BE%D0%BC-crs/
1 /2016/12/14/virtualenv-%D0%B4%D0%BB%D1%8F-%D0%BF%D0%BB%D0%B0%D0%B3%D0%B8%D0%BD%D0%BE%D0%B2-python-scrappy-%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82-%D0%BD%D0%B0-debian-jessie/
1 /2017/06/07/
Ошибки веб-сервера/приложения c момента последнего запуска:
11 404
1 499
Список всех кодов HTTP ответа с указанием их кол-ва с момента последнего запуска скрипта:
61 200
11 404
9 301
1 499
```
...